{% if comment.level == 1 %}
    <blockquote class="section comment entry-comment subject comment-level--{{ comment.level }}"
                id="entry-comment-{{ comment.id }}" data-controller="comment subject mentions"
                data-subject-parent-value="" data-action="">
        <header>
            <a
                    data-action="mouseover->mentions#user_popup mouseout->mentions#user_popup_out"
                    class="user-inline"
                    title="Correu del user"
                    href="{% url 'view_user' comment.author.username %}">
                {{ comment.author.username }}</a>,
            <time class="timeago">{{ comment.creation_data|timesince }}</time>
            {% if comment.last_edited %}
                (edited
                <time class="timeago">{{ comment.last_edited|timesince }}</time> ago)
            {% endif %}
        </header>
        <figure>
            <a data-action="mouseover->mentions#user_popup mouseout->mentions#user_popup_out"
               data-mentions-username-param="Correu del user">
                <div class="no-avatar"></div>
            </a>
        </figure>
        <div class="content" style="">
            <p>{{ comment.body }}</p>
        </div>

        <aside class="vote">
            <form method="post" class="vote__up"
                  action="{% url 'like_comment' thread_id=thread.id comment_id=comment.id %}">
                <button type="submit" title="Favorito" aria-label="Favorito"
                        data-action="subject#vote">
                    <span data-subject-target="favCounter">{{ comment.num_likes }}</span> <span><i
                        class="fa-solid fa-arrow-up"></i></span>
                </button>
                <input type="hidden" name="token"
                       value="60ff0c14f9e35e6a75bec98c99.mT1WbCeXf6UWbT_mYbHuFGRXxUnEwxwzS2fMNELv5s0.30siDUOuDc0nBVqSENKCTA0YlCHptWxRJgyucSioi5_efAYLUPJKziYZeg">
            </form>
            <form method="post" class="vote__down"
                  action="{% url 'dislike_comment' thread_id=thread.id comment_id=comment.id %}">
                <button type="submit" title="Votos negativos" aria-label="Votos negativos"
                        data-action="subject#vote" class="vote__up">
                    <span data-subject-target="downvoteCounter">{{ comment.num_dislikes }}</span> <span><i
                        class="fa-solid fa-arrow-down"></i></span>
                </button>
                <input type="hidden" name="token"
                       value="eef764ee7e85233c30bcb.tJSvg20gN3OprsuVmVn9qPxLe-H0hBdA5kJmrUUX0Kc.5sfj61xjZRvj5aH4wDqo4ZV5LYWF9Udwogsk4ixItZX69ebENENEJNrqhg">
            </form>
        </aside>

        <footer>
            <menu>
                <li>
                    <a class="stretched-link"
                       onclick="document.getElementById('reply_{{ comment.id }}').style.display = 'block';"
                       data-action=" subject#getForm">responder</a>
                </li>
                <li>
                    <!-- TODO: check if user is the author of the comment -->
                    <a class="stretched-link"
                       onclick="document.getElementById('edit_{{ comment.id }}').style.display = 'block';"
                       data-action=" subject#getForm">edit</a>
                </li>
                <li>
                    <!-- TODO: check if user is the author of the comment -->
                    <a class="stretched-link"
                       onclick="return confirm('¿Estás seguro de que quieres borrar este comentario?');"
                       href="{% url 'delete_comment' thread_id=thread.id comment_id=comment.id %}"
                       data-action=" subject#getForm">delete</a>
                </li>
            </menu>
            <h3 hidden="">Añadir un comentario</h3>
            <form id="reply_{{ comment.id }}" name="entry_comment" method="post"
                  action="{% url 'add_reply' thread_id=thread.id comment_id=comment.id %}"
                  class="comment-add" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <div><label for="entry_comment_6616cdb65f3850.74137319_body"></label><textarea
                        id="entry_comment_6616cdb65f3850.74137319_body"
                        name="entry_comment[body]"
                        data-controller="input-length rich-textarea autogrow"
                        data-action="input-length#updateDisplay"
                        data-input-length-max-value="5000"
                        style="overflow: hidden; height: 66px;"></textarea>
                </div>
                <div class="row actions">
                    <ul>
                        <li class="dropdown">
                            <div>
                                <button type="submit"
                                        id="entry_comment_6616cdb65f3850.74137319_submit"
                                        name="entry_comment[submit]" class="btn btn__primary"
                                        data-action="subject#sendForm">Añadir un comentario
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>
            <form id="edit_{{ comment.id }}" name="edit_comment" method="post"
                  action="{% url 'edit_comment' thread_id=thread.id comment_id=comment.id %}"
                  class="comment-add" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <div><label for="entry_comment_6616cdb65f3850.74137319_body"></label><textarea
                        id="entry_comment_6616cdb65f3850.74137319_body"
                        name="entry_comment[body]"
                        data-controller="input-length rich-textarea autogrow"
                        data-action="input-length#updateDisplay"
                        data-input-length-max-value="5000"
                        style="overflow: hidden; height: 66px;">{{ comment.body }}</textarea>
                </div>
                <div class="row actions">
                    <ul>
                        <li class="dropdown">
                            <div>
                                <button type="submit"
                                        id="entry_comment_6616cdb65f3850.74137319_submit"
                                        name="entry_comment[submit]" class="btn btn__primary"
                                        data-action="subject#sendForm">Update comment
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>
        </footer>
    </blockquote>
{% endif %}
{% for reply in comment.root_comments.all %}
    <blockquote
            class="section comment entry-comment subject comment-level--{{ reply.comment_reply.level }}"
            id="entry-comment-{{ reply.comment_reply.id }}"
            data-controller="comment subject mentions"
            data-subject-parent-value="" data-action="">
        <header>
            <a
                    data-action="mouseover->mentions#user_popup mouseout->mentions#user_popup_out"
                    class="user-inline"
                    title="Correu del user"
                    href="{% url 'view_user' comment.author.username %}">
                {{ reply.comment_reply.author.username }}</a>,
            <time class="timeago">{{ reply.comment_reply.creation_data|timesince }}</time>
            {% if reply.comment_reply.last_edited %}
                (edited
                <time class="timeago">{{ reply.comment_reply.last_edited|timesince }}</time> ago)
            {% endif %}
        </header>
        <figure>
            <a data-action="mouseover->mentions#user_popup mouseout->mentions#user_popup_out"
               data-mentions-username-param="Correu del user">
                <div class="no-avatar"></div>
            </a>
        </figure>
        <div class="content" style="">
            <p>{{ reply.comment_reply.body }}</p>
        </div>

        <aside class="vote">
            <form method="post" class="vote__up"
                  action="{% url 'like_comment' thread.id reply.comment_reply.id %}">
                <button type="submit" title="Favorito" aria-label="Favorito"
                        data-action="subject#vote">
                    <span data-subject-target="favCounter">{{ reply.comment_reply.num_likes }}</span> <span><i
                        class="fa-solid fa-arrow-up"></i></span>
                </button>
                <input type="hidden" name="token"
                       value="60ff0c14f9e35e6a75bec98c99.mT1WbCeXf6UWbT_mYbHuFGRXxUnEwxwzS2fMNELv5s0.30siDUOuDc0nBVqSENKCTA0YlCHptWxRJgyucSioi5_efAYLUPJKziYZeg">
            </form>
            <form method="post" class="vote__down"
                  action="{% url 'dislike_comment' thread.id reply.comment_reply.id %}">
                <button type="submit" title="Votos negativos" aria-label="Votos negativos"
                        data-action="subject#vote" class="vote__up">
                    <span data-subject-target="downvoteCounter">{{ reply.comment_reply.num_dislikes }}</span> <span><i
                        class="fa-solid fa-arrow-down"></i></span>
                </button>
                <input type="hidden" name="token"
                       value="eef764ee7e85233c30bcb.tJSvg20gN3OprsuVmVn9qPxLe-H0hBdA5kJmrUUX0Kc.5sfj61xjZRvj5aH4wDqo4ZV5LYWF9Udwogsk4ixItZX69ebENENEJNrqhg">
            </form>
        </aside>

        <footer>
            <menu>
                <li>
                    <a class="stretched-link"
                       onclick="document.getElementById('reply_{{ reply.comment_reply.id }}').style.display = 'block';"
                       data-action=" subject#getForm">responder</a>
                </li>
                <li>
                    <!-- TODO: check if user is the author of the comment -->
                    <a class="stretched-link"
                       onclick="document.getElementById('edit_{{ reply.comment_reply.id }}').style.display = 'block';"
                       data-action=" subject#getForm">edit</a>
                </li>
                <li>
                    <!-- TODO: check if user is the author of the comment -->
                    <a class="stretched-link"
                       onclick="return confirm('¿Estás seguro de que quieres borrar este comentario?');"
                       href="{% url 'delete_comment' thread_id=thread.id comment_id=reply.comment_reply.id %}"
                       data-action=" subject#getForm">delete</a>
                </li>
            </menu>
            <h3 hidden="">Añadir un comentario</h3>
            <form id="reply_{{ reply.comment_reply.id }}" name="entry_comment" method="post"
                  action="{% url 'add_reply' thread_id=thread.id comment_id=reply.comment_reply.id %}"
                  class="comment-add" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <div><label
                        for="entry_comment_6616cdb65f3850.74137319_body"></label><textarea
                        id="entry_comment_6616cdb65f3850.74137319_body"
                        name="entry_comment[body]"
                        data-controller="input-length rich-textarea autogrow"
                        data-action="input-length#updateDisplay"
                        data-input-length-max-value="5000"
                        style="overflow: hidden; height: 66px;"></textarea>
                </div>
                <div class="row actions">
                    <ul>
                        <li class="dropdown">
                            <div>
                                <button type="submit"
                                        id="entry_comment_6616cdb65f3850.74137319_submit"
                                        name="entry_comment[submit]"
                                        class="btn btn__primary"
                                        data-action="subject#sendForm">Añadir un comentario
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>
            <form id="edit_{{ reply.comment_reply.id }}" name="edit_comment" method="post"
                  action="{% url 'edit_comment' thread_id=thread.id comment_id=reply.comment_reply.id %}"
                  class="comment-add" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <div><label for="entry_comment_6616cdb65f3850.74137319_body"></label><textarea
                        id="entry_comment_6616cdb65f3850.74137319_body"
                        name="entry_comment[body]"
                        data-controller="input-length rich-textarea autogrow"
                        data-action="input-length#updateDisplay"
                        data-input-length-max-value="5000"
                        style="overflow: hidden; height: 66px;">{{ reply.comment_reply.body }}</textarea>
                </div>
                <div class="row actions">
                    <ul>
                        <li class="dropdown">
                            <div>
                                <button type="submit"
                                        id="entry_comment_6616cdb65f3850.74137319_submit"
                                        name="entry_comment[submit]" class="btn btn__primary"
                                        data-action="subject#sendForm">Update comment
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </form>
        </footer>
    </blockquote>
    {% include 'comments_tree.html' with comment=reply.comment_reply %}
{% endfor %}
